---
title: "Homework"
author: "Yaling Hong"
date: "2022/9/22"
output: html_document
---

```{r warning=FALSE, include=FALSE}
library(nycflights13)
library(dplyr)
library(ggplot2)
```
#1 

\textbf{How many flights have a missing dep_time?}

8255
```{r}
flights%>%
  filter(is.na(dep_time))%>%
  summarise(n())
```


\textbf{What other variables are missing?}

dep_delay, arr_time, arr_delay, tailnum and air_time 

```{r}
f<-function(x){
  return(if_else(T%in%is.na(x),true=T,false=F))
}
v<-flights%>%
  filter(is.na(dep_time))%>%
  apply(2,f)
names(which(v==T))
```


\textbf{What might these rows represent?}

Maybe these flights are canceled so the departure time is not recorded.


# 2

\textbf{Currently dep_time and sched_dep_time are convenient to look at, but hard to compute with because they're not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.}

```{r}
flights%>%
  mutate(dep_time_in_minute=60*(dep_time%/%100)+dep_time%%100,
         sched_dep_time_in_minute=60*(sched_dep_time%/%100)+sched_dep_time%%100)
```

# 3

\textbf{Look at the number of canceled flights per day. Is there a pattern?} 


First, we can take a quick glance of the data. The result below shows that all missing values in dep_delay is caused by cancellation.

```{r}
flights%>%
  select(dep_time,dep_delay)%>%
  filter(is.na(dep_time))%>%
  summary()
```


```{r}
df<-flights%>%
  mutate(status=is.na(dep_time))%>%
  group_by(month,day)%>%
  summarise(number=sum(status),
            proportion=sum(status)/n(),
            avg_delay=sum(dep_delay>0,na.rm=T)/n())
df  
```

From the plot below we know that there isn't a pattern of the numbers of canceled flights per day. 

```{r}
ggplot(df,aes(x=day,y=number))+geom_point(aes(color=month))+facet_wrap(~month)
```


\textbf{Is the proportion of canceled flights related to the average delay?}

Yes.When the average delay is less than 0.4, the proportion is very close to 0 despite several outliers. As the average delay increases, proportion of cancellation seems to increase as well.

```{r}
ggplot(df,aes(x=avg_delay,y=proportion))+geom_point()
```

